<!DOCTYPE html>
<html>
<head>
    <title>Recipe Book - Dashboard</title>
    <style>
        /* Restoring your original website look */
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #f4f4f4; color: #333; }
        nav { background: #28a745; color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .main-container { max-width: 1000px; margin: 40px auto; padding: 0 20px; display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }
        
        /* Sidebar Form */
        .recipe-form { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); height: fit-content; }
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        .btn-add { background: #28a745; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        .btn-add:hover { background: #218838; }

        /* Recipe Feed */
        .feed { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .recipe-card { border-bottom: 1px solid #eee; padding: 15px 0; animation: fadeIn 0.5s ease; }
        .recipe-card:last-child { border: none; }
        .recipe-card h3 { margin: 0 0 10px 0; color: #28a745; }
        .recipe-card p { margin: 0; font-size: 14px; line-height: 1.6; color: #666; }
        
        .logout-link { color: white; cursor: pointer; text-decoration: underline; font-size: 14px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <nav>
        <h2 style="margin:0;">RecipeBook</h2>
        <div>
            <span id="userDisplay" style="margin-right: 15px; font-size: 14px;"></span>
            <span class="logout-link" onclick="handleLogout()">Logout</span>
        </div>
    </nav>

    <div class="main-container">
        <div class="recipe-form">
            <h3>Add New Recipe</h3>
            <input type="text" id="recipeTitle" placeholder="Recipe Name (e.g., Spicy Tacos)">
            <textarea id="recipeIngredients" rows="5" placeholder="List ingredients and steps here..."></textarea>
            <button class="btn-add" onclick="saveRecipe()">Save to My Book</button>
        </div>

        <div class="feed">
            <h3>My Saved Recipes</h3>
            <div id="listContent">Connecting to cloud...</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA-re9plYFbo2hnpkt1oTwJo4ZHes6WZaU",
            authDomain: "recipebook-fb16b.firebaseapp.com",
            projectId: "recipebook-fb16b",
            storageBucket: "recipebook-fb16b.firebasestorage.app",
            messagingSenderId: "213197710946",
            appId: "1:213197710946:web:f3a05df4fae61ac023933b"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;

        // AUTH CHECK
        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('userDisplay').innerText = user.email;
                loadRecipes(user.uid);
            } else {
                window.location.href = 'index.html';
            }
        });

        // SAVE LOGIC
        window.saveRecipe = async () => {
            const title = document.getElementById('recipeTitle').value;
            const text = document.getElementById('recipeIngredients').value;

            if (!title || !text) return alert("Please fill in both fields!");

            try {
                await addDoc(collection(db, "recipes"), {
                    uid: currentUser.uid,
                    title: title,
                    ingredients: text,
                    createdAt: new Date()
                });
                document.getElementById('recipeTitle').value = "";
                document.getElementById('recipeIngredients').value = "";
            } catch (e) {
                alert("Error saving recipe. Check your Database Rules!");
            }
        };

        // LOAD LOGIC
        function loadRecipes(uid) {
            const q = query(collection(db, "recipes"), where("uid", "==", uid));
            onSnapshot(q, (snapshot) => {
                const listDiv = document.getElementById('listContent');
                listDiv.innerHTML = "";
                
                if (snapshot.empty) {
                    listDiv.innerHTML = "<p>No recipes found. Start adding some!</p>";
                    return;
                }

                snapshot.forEach((doc) => {
                    const r = doc.data();
                    const card = document.createElement('div');
                    card.className = "recipe-card";
                    card.innerHTML = `<h3>${r.title}</h3><p>${r.ingredients.replace(/\n/g, '<br>')}</p>`;
                    listDiv.appendChild(card);
                });
            });
        }

        // LOGOUT
        window.handleLogout = () => signOut(auth);
    </script>
</body>
</html>